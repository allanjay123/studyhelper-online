<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyHelper | Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
}
header{
  background:white;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:white;
  border-radius:12px;
  padding:15px;
  margin-bottom:20px;
}
.calendar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.calendar-grid{
  display:grid;
  grid-template-columns: repeat(7,1fr);
  gap:8px;
  margin-top:15px;
}
.day{
  padding:10px;
  background:#f1f1f1;
  border-radius:8px;
  text-align:center;
  cursor:pointer;
}
.day.today{
  background:#667eea;
  color:white;
}
.day.hasTask{
  border:2px solid #ff5252;
}
.task{
  background:#f7f7f7;
  padding:8px;
  border-radius:6px;
  margin-top:6px;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#667eea;
  color:white;
  cursor:pointer;
}
input{
  width:100%;
  padding:8px;
  margin-top:8px;
}
</style>
</head>

<body>

<header>
  <strong>ðŸ“… StudyHelper Calendar</strong>
  <button onclick="location.href='home.html'">â¬… Back</button>
</header>

<div class="container">

  <div class="card">
    <div class="calendar-header">
      <button id="prev">â—€</button>
      <h3 id="monthYear"></h3>
      <button id="next">â–¶</button>
    </div>
    <div class="calendar-grid" id="calendar"></div>
  </div>

  <div class="card">
    <h3>Add Task on <span id="selectedDate"></span></h3>
    <input id="taskText" placeholder="Task name">
    <button id="addTask">Add Task</button>
    <div id="taskList"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
let currentDate = new Date();
let selectedDate = "";

const calendarEl = document.getElementById("calendar");
const monthYear = document.getElementById("monthYear");
const selectedDateEl = document.getElementById("selectedDate");
const taskList = document.getElementById("taskList");

onAuthStateChanged(auth, user=>{
  if(!user) location.href="index.html";
  currentUser = user;
  renderCalendar();
});

function renderCalendar(){
  calendarEl.innerHTML="";
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  monthYear.textContent =
    currentDate.toLocaleString("default",{month:"long"})+" "+year;

  const firstDay = new Date(year,month,1).getDay();
  const daysInMonth = new Date(year,month+1,0).getDate();

  for(let i=0;i<firstDay;i++){
    calendarEl.innerHTML+=`<div></div>`;
  }

  for(let d=1; d<=daysInMonth; d++){
    const fullDate = `${year}-${month+1}-${d}`;
    const div = document.createElement("div");
    div.className="day";
    div.textContent=d;

    const today = new Date();
    if(
      d===today.getDate() &&
      month===today.getMonth() &&
      year===today.getFullYear()
    ){
      div.classList.add("today");
    }

    div.onclick=()=>{
      selectedDate = fullDate;
      selectedDateEl.textContent = fullDate;
      loadTasks();
    };

    calendarEl.appendChild(div);
  }
}

document.getElementById("prev").onclick=()=>{
  currentDate.setMonth(currentDate.getMonth()-1);
  renderCalendar();
};
document.getElementById("next").onclick=()=>{
  currentDate.setMonth(currentDate.getMonth()+1);
  renderCalendar();
};

document.getElementById("addTask").onclick=async()=>{
  if(!taskText.value || !selectedDate) return alert("Select date & task");
  await addDoc(collection(db,"calendarTasks"),{
    uid: currentUser.uid,
    text: taskText.value,
    date: selectedDate
  });
  taskText.value="";
};

function loadTasks(){
  taskList.innerHTML="";
  const q = query(
    collection(db,"calendarTasks"),
    where("uid","==",currentUser.uid),
    where("date","==",selectedDate)
  );
  onSnapshot(q,snap=>{
    taskList.innerHTML="";
    snap.forEach(d=>{
      taskList.innerHTML+=`<div class="task">${d.data().text}</div>`;
    });
  });
}
</script>

</body>
  </html>

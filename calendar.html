<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StudyHelper - Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #6a5acd, #7b68ee);
    }

    header {
      background: white;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background: #667eea;
      color: white;
      cursor: pointer;
    }

    .container {
      max-width: 900px;
      margin: auto;
      padding: 15px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }

    input, button {
      padding: 8px;
      margin-top: 6px;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 10px;
    }

    .day {
      border: 1px solid #ddd;
      min-height: 90px;
      padding: 5px;
      font-size: 12px;
    }

    .hasEvent {
      background: #e6edff;
    }

    .day strong {
      display: block;
      margin-bottom: 4px;
    }
  </style>
</head>

<body>

<header>
  <strong>ðŸ“… Study Calendar</strong>
  <button onclick="location.href='home.html'">â¬… Back</button>
</header>

<div class="container">

  <!-- ADD EVENT -->
  <div class="card">
    <h3>Add Event</h3>
    <input type="text" id="eventTitle" placeholder="Event title">
    <input type="date" id="eventDate">
    <button id="addEventBtn">Add Event</button>
  </div>

  <!-- CALENDAR -->
  <div class="card">
    <h3 id="monthTitle"></h3>
    <div id="calendar"></div>
  </div>

</div>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // âš ï¸ PALITAN GAMIT ANG FIREBASE CONFIG MO
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const calendarDiv = document.getElementById("calendar");
  const monthTitle = document.getElementById("monthTitle");
  const addEventBtn = document.getElementById("addEventBtn");

  let currentUserUID = null;

  // ðŸ” AUTH CHECK
  onAuthStateChanged(auth, user => {
    if (!user) {
      location.href = "index.html";
    } else {
      currentUserUID = user.uid;
      loadEvents();
    }
  });

  // âž• ADD EVENT
  addEventBtn.addEventListener("click", async () => {
    const title = document.getElementById("eventTitle").value;
    const date = document.getElementById("eventDate").value;

    if (!title || !date) return alert("Fill all fields");

    await addDoc(collection(db, "users", currentUserUID, "events"), {
      title,
      date
    });

    document.getElementById("eventTitle").value = "";
    document.getElementById("eventDate").value = "";
  });

  // ðŸ“† LOAD EVENTS
  function loadEvents() {
    const q = query(collection(db, "users", currentUserUID, "events"));

    onSnapshot(q, snap => {
      const events = [];
      snap.forEach(d => events.push(d.data()));
      renderCalendar(events);
      checkReminders(events);
    });
  }

  // ðŸ“… RENDER CALENDAR
  function renderCalendar(events) {
    calendarDiv.innerHTML = "";

    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();

    monthTitle.textContent =
      now.toLocaleString("default", { month: "long" }) + " " + year;

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) {
      calendarDiv.innerHTML += `<div></div>`;
    }

    for (let d = 1; d <= daysInMonth; d++) {
      const fullDate =
        year + "-" +
        String(month + 1).padStart(2, "0") + "-" +
        String(d).padStart(2, "0");

      const dayEvents = events.filter(e => e.date === fullDate);

      calendarDiv.innerHTML += `
        <div class="day ${dayEvents.length ? "hasEvent" : ""}">
          <strong>${d}</strong>
          ${dayEvents.map(e => `<div>â€¢ ${e.title}</div>`).join("")}
        </div>
      `;
    }
  }

  // ðŸ”” REMINDER (TODAY)
  if ("Notification" in window) {
    Notification.requestPermission();
  }

  function checkReminders(events) {
    const today = new Date().toISOString().split("T")[0];
    events.forEach(e => {
      if (e.date === today && Notification.permission === "granted") {
        new Notification("ðŸ“š Study Reminder", {
          body: e.title
        });
      }
    });
  }
</script>

</body>
</html>

<script type="module">
  import { auth } from "./firebase.js";
  import {
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  const loginCard = document.getElementById("loginCard");
  const dashboard = document.getElementById("dashboard");

  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");

  const loginMsg = document.getElementById("loginMsg");
  const userEmail = document.getElementById("userEmail");

  // LOGIN
  loginBtn.addEventListener("click", async () => {
    loginMsg.textContent = "Logging in...";
    try {
      await signInWithEmailAndPassword(
        auth,
        emailInput.value.trim(),
        passwordInput.value.trim()
      );
    } catch (err) {
      loginMsg.textContent = err.message;
    }
  });

  // AUTH STATE
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginCard.classList.add("hidden");
      dashboard.classList.remove("hidden");
      userEmail.textContent = "Logged in as: " + user.email;
    } else {
      dashboard.classList.add("hidden");
      loginCard.classList.remove("hidden");
    }
  });

  // LOGOUT
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
  });
</script>

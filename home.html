<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyHelper</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#667eea,#764ba2);
}
header{
  background:#fff;
  padding:10px 15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:1000px;
  margin:20px auto;
  padding:10px;
}
.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
input,textarea{
  width:100%;
  padding:8px;
  margin-bottom:8px;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#4caf50;
  color:white;
  cursor:pointer;
}
button.red{background:#f44336}
.quiz-question{margin-bottom:15px}
.choice{display:block;margin-left:15px}
</style>
</head>

<body>

<header>
  <b>StudyHelper</b>
  <button onclick="toggleQuiz()">ðŸ§  Quiz</button>
</header>

<div class="container">

<!-- NOTES -->
<div class="card">
  <h3>Add Note</h3>
  <input id="noteTitle" placeholder="Title">
  <textarea id="noteBody" placeholder="Your note (sentences)"></textarea>
  <button onclick="saveNote()">Save Note</button>
</div>

<div class="card">
  <h3>Your Notes</h3>
  <div id="notesList"></div>
</div>

<!-- QUIZ -->
<div class="card" id="quizBox" style="display:none">
  <h3>Generated Quiz</h3>
  <button onclick="generateQuiz()">Generate from Notes</button>
  <div id="quizArea"></div>
  <button onclick="submitQuiz()">Submit Quiz</button>
  <h3 id="score"></h3>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCk3YyAne_nz0fwChI6557R8RtcmlMAawA",
  authDomain: "studyhelper-app.firebaseapp.com",
  projectId: "studyhelper-app"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let uid;
let notesData = [];
let quizData = [];

onAuthStateChanged(auth,user=>{
  if(!user) return;
  uid=user.uid;
  loadNotes();
});

window.toggleQuiz=()=>{
  quizBox.style.display =
    quizBox.style.display==="none"?"block":"none";
};

/* NOTES */
window.saveNote = async()=>{
  if(!noteTitle.value || !noteBody.value) return;
  await addDoc(collection(db,"users",uid,"notes"),{
    title:noteTitle.value,
    body:noteBody.value
  });
  noteTitle.value="";
  noteBody.value="";
};

function loadNotes(){
  onSnapshot(collection(db,"users",uid,"notes"),snap=>{
    notesList.innerHTML="";
    notesData=[];
    snap.forEach(d=>{
      notesData.push(d.data().body);
      notesList.innerHTML+=`
        <p><b>${d.data().title}</b><br>${d.data().body}</p>`;
    });
  });
}

/* QUIZ */
window.generateQuiz=()=>{
  quizArea.innerHTML="";
  quizData=[];
  score.innerText="";

  let text = notesData.join(" ");
  let sentences = text.split(".").filter(s=>s.trim().length>15);

  sentences.forEach((s,i)=>{
    let words = s.trim().split(" ");
    let answer = words.pop();

    let choices=[answer,"Option A","Option B","Option C"]
      .sort(()=>Math.random()-0.5);

    quizData.push({answer});

    quizArea.innerHTML+=`
      <div class="quiz-question">
        <b>${i+1}. ${words.join(" ")} _____</b>
        ${choices.map(c=>`
          <label class="choice">
            <input type="radio" name="q${i}" value="${c}"> ${c}
          </label>`).join("")}
      </div>
    `;
  });
};

window.submitQuiz=()=>{
  let scoreCount=0;
  quizData.forEach((q,i)=>{
    let sel=document.querySelector(`input[name="q${i}"]:checked`);
    if(sel && sel.value===q.answer) scoreCount++;
  });
  score.innerText=`Score: ${scoreCount} / ${quizData.length}`;
};
</script>

</body>
</html>

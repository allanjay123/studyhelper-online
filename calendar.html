<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyHelper | Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
}
header{
  background:#fff;
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:900px;
  margin:20px auto;
}
.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
.task{
  padding:10px;
  border-bottom:1px solid #eee;
}
.overdue{
  color:red;
}
.done{
  text-decoration:line-through;
  color:gray;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#667eea;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <strong>ðŸ“… StudyHelper Calendar</strong>
  <button onclick="location.href='home.html'">â¬… Back</button>
</header>

<div class="container">
  <div class="card">
    <h3>Tasks by Due Date</h3>
    <div id="taskList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCk3YyAne_nz0fwChI6557R8RtcmlMAawA",
  authDomain: "studyhelper-app.firebaseapp.com",
  projectId: "studyhelper-app"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const taskList = document.getElementById("taskList");

onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "index.html";
    return;
  }

  const tasksRef = collection(db, "users", user.uid, "tasks");

  onSnapshot(tasksRef, snap => {
    taskList.innerHTML = "";

    snap.forEach(doc => {
      const t = doc.data();

      if (!t.dueDate) return; // skip tasks without date

      const today = new Date().toISOString().split("T")[0];
      const overdue = !t.done && t.dueDate < today;

      taskList.innerHTML += `
        <div class="task ${overdue ? "overdue" : ""} ${t.done ? "done" : ""}">
          <strong>${t.text}</strong><br>
          Due: ${t.dueDate}
        </div>
      `;
    });
  });
});
</script>

</body>
</html>
